<html>
  <style>
    table tr {
      border: none;
      display: flex;
    }

    table td {
      padding: unset;
      width: 24px;
      height: 24px;
      padding-right: 6px;
      padding-bottom: 6px;
      box-sizing: content-box;
    }
    
    .input__radio input {
      position: absolute;
      opacity: 0;
      cursor: pointer;
      height: 0;
      width: 0;
    }

    table input[type=radio]~label {
      width: 24px;
      height: 24px;
      border-radius: 2px;
      box-shadow: 0 0 0 1px rgba(0,0,0, .175);
      position: absolute;
    }

    table input[type=radio]~label:hovered {
      cursor: pointer;
    }

    table input[type=radio]~label.hovered {
      background-color: rgba(0,0,0, .05);
      box-shadow: 0 0 0 1px rgba(0,0,0, .315);
    }

    table input[type=radio]~label.active {
      background-color: #F0FBFC;
      box-shadow: 0 0 0 2px #019CAA; ;
    }
    
    table input[type=radio]~label.active.hovered {
      background-color: #C6F2F6;
      box-shadow: 0 0 0 2px #019CAA;
    }
  </style>  
  <body>
    <section class="grid-selector-container">
      <div class="table-dimensions-config">
        <div class="input-container">
          <label for="number-of-cols">Columns</label>
          <input type="number" min="0" max="24" name="number-of-cols" id="number-of-cols">
        </div>
        <div class="input-container">
          <label for="number-of-rows">Rows</label>
          <input type="number" min="0" max="1000" name="number-of-rows" id="number-of-rows">
        </div>
      </div>

      <table class="grid-selector">
        <tbody>
          <tr>
            <td class="input__radio">
              <input type="radio" id="t1x1" name="selection">
              <label for="t1x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t1x2" name="selection">
              <label for="t1x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t1x3" name="selection">
              <label for="t1x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t1x4" name="selection">
              <label for="t1x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t1x5" name="selection">
              <label for="t1x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t1x6" name="selection">
              <label for="t1x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t1x7" name="selection">
              <label for="t1x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t1x8" name="selection">
              <label for="t1x1"></label>
            </td>
          </tr>
          <tr>
            <td class="input__radio">
              <input type="radio" id="t2x1" name="selection">
              <label for="t2x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t2x2" name="selection">
              <label for="t2x2"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t2x3" name="selection">
              <label for="t2x3"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t2x4" name="selection">
              <label for="t2x4"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t2x5" name="selection">
              <label for="t2x5"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t2x6" name="selection">
              <label for="t2x6"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t2x7" name="selection">
              <label for="t2x7"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t2x8" name="selection">
              <label for="t2x8"></label>
            </td>
          </tr>
          <tr>
            <td class="input__radio">
              <input type="radio" id="t3x1" name="selection">
              <label for="t3x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t3x2" name="selection">
              <label for="t3x2"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t3x3" name="selection">
              <label for="t3x3"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t3x4" name="selection">
              <label for="t3x4"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t3x5" name="selection">
              <label for="t3x5"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t3x6" name="selection">
              <label for="t3x6"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t3x7" name="selection">
              <label for="t3x7"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t3x8" name="selection">
              <label for="t3x8"></label>
            </td>
          </tr>
          <tr>
            <td class="input__radio">
              <input type="radio" id="t4x1" name="selection">
              <label for="t4x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t4x2" name="selection">
              <label for="t4x2"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t4x3" name="selection">
              <label for="t4x3"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t4x4" name="selection">
              <label for="t4x4"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t4x5" name="selection">
              <label for="t4x5"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t4x6" name="selection">
              <label for="t4x6"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t4x7" name="selection">
              <label for="t4x7"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t4x8" name="selection">
              <label for="t4x8"></label>
            </td>
          </tr>
          <tr>
            <td class="input__radio">
              <input type="radio" id="t5x1" name="selection">
              <label for="t5x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t5x2" name="selection">
              <label for="t5x2"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t5x3" name="selection">
              <label for="t5x3"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t5x4" name="selection">
              <label for="t5x4"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t5x5" name="selection">
              <label for="t5x5"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t5x6" name="selection">
              <label for="t5x6"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t5x7" name="selection">
              <label for="t5x7"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t5x8" name="selection">
              <label for="t5x8"></label>
            </td>
          </tr>
          <tr>
            <td class="input__radio">
              <input type="radio" id="t6x1" name="selection">
              <label for="t6x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t6x2" name="selection">
              <label for="t6x2"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t6x3" name="selection">
              <label for="t6x3"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t6x4" name="selection">
              <label for="t6x4"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t6x5" name="selection">
              <label for="t6x5"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t6x6" name="selection">
              <label for="t6x6"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t6x7" name="selection">
              <label for="t6x7"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t6x8" name="selection">
              <label for="t6x8"></label>
            </td>
          </tr>
          <tr>
            <td class="input__radio">
              <input type="radio" id="t7x1" name="selection">
              <label for="t7x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t7x2" name="selection">
              <label for="t7x2"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t7x3" name="selection">
              <label for="t7x3"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t7x4" name="selection">
              <label for="t7x4"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t7x5" name="selection">
              <label for="t7x5"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t7x6" name="selection">
              <label for="t7x6"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t7x7" name="selection">
              <label for="t7x7"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t7x8" name="selection">
              <label for="t7x8"></label>
            </td>
          </tr>
          <tr>
            <td class="input__radio">
              <input type="radio" id="t8x1" name="selection">
              <label for="t8x1"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t8x2" name="selection">
              <label for="t8x2"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t8x3" name="selection">
              <label for="t8x3"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t8x4" name="selection">
              <label for="t8x4"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t8x5" name="selection">
              <label for="t8x5"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t8x6" name="selection">
              <label for="t8x6"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t8x7" name="selection">
              <label for="t8x7"></label>
            </td>
            <td class="input__radio">
              <input type="radio" id="t8x8" name="selection">
              <label for="t8x8"></label>
            </td>
          </tr>
        </tbody>
      </table>
    </section>

    <hr>

    <button class="btn-create-table">Create table</button>
    <button class="btn-continue">Continue</button>

    <script>
      const allGridSquares = Array.from(document.querySelectorAll('.input__radio label'));
      const gridSelector = document.querySelector('.grid-selector');
      const gridSelectorRows = Array.from(gridSelector.children[0].children);
      const rowCountInput = document.getElementById('number-of-rows')
      const colCountInput = document.getElementById('number-of-cols')
      const createTableButton = document.querySelector('.btn-create-table')
      const continueButton = document.querySelector('.btn-continue')
      let activeGridSquares = [0,0];

      function setGridSquares(state, selectedRows, colIndex) {
        // For every row that is currently included in the selection...
        selectedRows.map((row, index) => {
          const currentRow = Array.from(row.children)
          
          // get just the relevant columns
          const selectedCols = currentRow.filter((gridSquare, index, arr) => {
            if (state === 'hovered') {
              return arr.indexOf(gridSquare) <= colIndex
            } else if (state === 'active') {
              return arr.indexOf(gridSquare) < colIndex
            }
          })

          // for every relevant item in the row...
          selectedCols.map((td, index) => {
            
            // get the <label> element within the <td>
            const label = Array.from(row.children)[index].children[1]
            
            // apply the apropriate class to the <label>
            if (state === 'active') {
              if (!label.classList.contains('active')) {
                label.classList.toggle('active')
              }
            } else if (state === 'hovered') {
              if (!label.classList.contains('hovered')) {
                label.classList.toggle('hovered')
              }
            }
          })
        })
      }

      function setGridBasedOnInputs(x, y) {
        activeGridSquares[0] =  x ? x : activeGridSquares[0] = 0
        activeGridSquares[1] =  y ? y : activeGridSquares[1] = 0 
        
        const allActiveGridSquares = Array.from(document.querySelectorAll('label.active'));

        // Wipe the slate clean:
        // Start by removing the "active" class from all grid squares.
        allActiveGridSquares.map(gridSquare => {
          gridSquare.classList.remove('active')
        })

        if (activeGridSquares[1] === 0 || activeGridSquares[0] === 0 ) {
          // if either of the inputs is empty, do nothing
          return 
        } else {
          // ...otherwise...
          const selectedRows = gridSelectorRows.filter((row, index) => index < activeGridSquares[0]);

          setGridSquares('active', selectedRows, activeGridSquares[1])
        }
      }

      // For every grid square, do this
      allGridSquares.map(gridSquare => {

        // handle mouse over behavior
        gridSquare.addEventListener('mouseover', function(e) {
          const indexOfCurrentRow = gridSelectorRows.indexOf(gridSquare.parentElement.parentElement);
          const selectedRows = gridSelectorRows.filter(row => gridSelectorRows.indexOf(row) <= indexOfCurrentRow);
          const allHoveredGridSquares = Array.from(document.querySelectorAll('label.hovered'));
          const indexOfCurrentCol = Array.from(gridSquare.parentElement.parentElement.children).indexOf(gridSquare.parentElement);

          // Wipe the slate clean:
          // Start by removing the "hovered" class from all grid squares.
          allHoveredGridSquares.map(gridSquare => {
            gridSquare.classList.remove('hovered')
          })
          
          setGridSquares('hovered', selectedRows, indexOfCurrentCol)
        })

        // handle the mouse out behavior of the grid container
        gridSelector.addEventListener('mouseleave', function(e) {

          // Wipe the slate clean:
          // removing the "hovered" class from all grid squares
          allGridSquares.map(gridSquare => {
            if (gridSquare.classList.contains('hovered')) {
              gridSquare.classList.toggle('hovered')
            }
          });
        })

        // handle the click behavior
        gridSquare.addEventListener('click', function(e) {
          const allHoveredGridSquares = Array.from(document.querySelectorAll('label.hovered'));
          const indexOfCurrentRow = gridSelectorRows.indexOf(gridSquare.parentElement.parentElement);
          const indexOfCurrentCol = Array.from(gridSquare.parentElement.parentElement.children).indexOf(gridSquare.parentElement);
          
          // Wipe the slate clean:
          // Start by removing the "active" class from all grid squares.
          allGridSquares.map(gridSquare => gridSquare.classList.remove('active'))

          // Apply the "active" class to any grid square that currently has the "hovered" class
          allHoveredGridSquares.map(gridSquare => gridSquare.classList.add('active'))

          // Set the value of the inputs to match the grid selection
          rowCountInput.value = indexOfCurrentRow + 1
          colCountInput.value = indexOfCurrentCol + 1

          // Store the current selection in a global variable
          activeGridSquares[0] = indexOfCurrentRow + 1
          activeGridSquares[1] = indexOfCurrentCol + 1
        });
      });

      // When the row input changes, call setGridBasedOnInputs()
      rowCountInput.addEventListener('input', e => {
        setGridBasedOnInputs(parseInt(e.target.value), activeGridSquares[1])
      });
      
      // When the column input changes, call setGridBasedOnInputs()
      colCountInput.addEventListener('input', e => {
        setGridBasedOnInputs(activeGridSquares[0], parseInt(e.target.value))
      });

      createTableButton.addEventListener('click', e => {
        parent.postMessage({ 
          pluginMessage: { 
            type: 'create-table',
            cols: activeGridSquares[1],
            rows: activeGridSquares[0]
          } 
        }, '*')
      })

    </script>
  </body>
</html>
